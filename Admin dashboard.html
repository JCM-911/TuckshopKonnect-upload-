<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - TuckshopKonnect</title>
    
    <!-- External CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js">
</head>
<body>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            min-height: 100vh;
            color: #e2e8f0;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: 280px;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(148, 163, 184, 0.2);
            z-index: 1000;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            padding: 2rem 1.5rem;
            border-bottom: 1px solid rgba(148, 163, 184, 0.2);
        }

        .sidebar-brand {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .brand-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #dc2626, #991b1b);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .brand-text h3 {
            font-weight: 800;
            font-size: 1.25rem;
            margin: 0;
        }

        .brand-text small {
            color: #94a3b8;
            font-weight: 500;
        }

        .nav-menu {
            padding: 1rem 0;
        }

        .nav-item {
            margin-bottom: 0.25rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            color: #94a3b8;
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-link:hover,
        .nav-link.active {
            background: rgba(220, 38, 38, 0.1);
            color: #dc2626;
            border-right: 3px solid #dc2626;
        }

        .nav-link i {
            width: 20px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            min-height: 100vh;
        }

        .top-bar {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(148, 163, 184, 0.2);
            padding: 1rem 2rem;
            display: flex;
            justify-content: between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
        }

        .admin-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-left: auto;
        }

        .admin-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #dc2626, #991b1b);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .logout-btn {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .content-area {
            padding: 2rem;
        }

        /* Dashboard Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 16px;
            padding: 2rem;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .stat-title {
            font-weight: 600;
            color: #94a3b8;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .stat-icon.primary { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
        .stat-icon.success { background: linear-gradient(135deg, #10b981, #047857); }
        .stat-icon.warning { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .stat-icon.danger { background: linear-gradient(135deg, #ef4444, #dc2626); }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: white;
            margin-bottom: 0.5rem;
        }

        .stat-change {
            font-size: 0.9rem;
            font-weight: 500;
        }

        .stat-change.positive { color: #10b981; }
        .stat-change.negative { color: #ef4444; }

        /* Content Sections */
        .section {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .section.active {
            display: block;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
        }

        .btn-primary {
            background: linear-gradient(135deg, #dc2626, #991b1b);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(220, 38, 38, 0.3);
        }

        /* Tables */
        .data-table {
            background: rgba(15, 23, 42, 0.8);
            border-radius: 16px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            overflow: hidden;
        }

        .table {
            margin: 0;
            color: #e2e8f0;
        }

        .table thead th {
            background: rgba(30, 41, 59, 0.8);
            border: none;
            padding: 1rem;
            font-weight: 600;
            color: #f8fafc;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 0.5px;
        }

        .table tbody td {
            padding: 1rem;
            border-color: rgba(148, 163, 184, 0.1);
        }

        .table tbody tr:hover {
            background: rgba(148, 163, 184, 0.05);
        }

        .badge {
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge.bg-success { background: linear-gradient(135deg, #10b981, #047857) !important; }
        .badge.bg-warning { background: linear-gradient(135deg, #f59e0b, #d97706) !important; }
        .badge.bg-danger { background: linear-gradient(135deg, #ef4444, #dc2626) !important; }

        /* Buttons */
        .btn-sm {
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
            border-radius: 6px;
            margin-right: 0.25rem;
        }

        .btn-info {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            border: none;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            border: none;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border: none;
        }

        /* Modals */
        .modal-content {
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 16px;
        }

        .modal-header {
            border-bottom: 1px solid rgba(148, 163, 184, 0.2);
        }

        .modal-footer {
            border-top: 1px solid rgba(148, 163, 184, 0.2);
        }

        .form-control, .form-select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(148, 163, 184, 0.3);
            color: #e2e8f0;
            border-radius: 8px;
        }

        .form-control:focus, .form-select:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: #dc2626;
            box-shadow: 0 0 0 0.2rem rgba(220, 38, 38, 0.25);
            color: #e2e8f0;
        }

        .form-label {
            color: #e2e8f0;
            font-weight: 500;
        }

        /* Alerts */
        .alert {
            border-radius: 12px;
            border: none;
            font-weight: 500;
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            color: #6ee7b7;
        }

        .alert-danger {
            background: rgba(239, 68, 68, 0.1);
            color: #fca5a5;
        }

        .alert-warning {
            background: rgba(245, 158, 11, 0.1);
            color: #fcd34d;
        }

        .alert-info {
            background: rgba(59, 130, 246, 0.1);
            color: #93c5fd;
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .quick-action-btn {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            text-decoration: none;
            color: #e2e8f0;
            transition: all 0.3s ease;
        }

        .quick-action-btn:hover {
            background: rgba(148, 163, 184, 0.1);
            color: #dc2626;
            transform: translateY(-2px);
        }

        .quick-action-btn i {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: #dc2626;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .content-area {
                padding: 1rem;
            }
        }

        /* Loading States */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .spinner-border-sm {
            width: 1rem;
            height: 1rem;
        }
    </style>
</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-brand">
                <div class="brand-icon">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <div class="brand-text">
                    <h3>TuckshopKonnect</h3>
                    <small>Admin Portal</small>
                </div>
            </div>
        </div>

        <nav class="nav-menu">
            <div class="nav-item">
                <a href="#" class="nav-link active" data-section="dashboard">
                    <i class="fas fa-chart-line"></i>
                    <span>Dashboard</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" data-section="parents">
                    <i class="fas fa-users"></i>
                    <span>Parent Management</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" data-section="students">
                    <i class="fas fa-graduation-cap"></i>
                    <span>Student Management</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" data-section="transactions">
                    <i class="fas fa-receipt"></i>
                    <span>Transactions</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" data-section="reports">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reports</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" data-section="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
            </div>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Bar -->
        <div class="top-bar">
            <h1 class="page-title" id="pageTitle">Dashboard Overview</h1>
            
            <div class="admin-info">
                <div class="admin-avatar">
                    <span id="adminInitials">A</span>
                </div>
                <div>
                    <div style="font-weight: 600;" id="adminName">Administrator</div>
                    <small class="text-muted" id="lastLogin">Last login: Today</small>
                </div>
                <a href="#" class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt me-1"></i>
                    Logout
                </a>
            </div>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Dashboard Section -->
            <div class="section active" id="dashboard">
                <!-- Quick Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Total Parents</div>
                            <div class="stat-icon primary">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="totalParents">0</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i> +0 this month
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Total Students</div>
                            <div class="stat-icon success">
                                <i class="fas fa-graduation-cap"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="totalStudents">0</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i> +0 this month
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Total Balance</div>
                            <div class="stat-icon warning">
                                <i class="fas fa-wallet"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="totalBalance">₦0</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i> +0% this week
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Low Balance Alerts</div>
                            <div class="stat-icon danger">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="lowBalanceCount">0</div>
                        <div class="stat-change negative">
                            <i class="fas fa-arrow-down"></i> 0 from yesterday
                        </div>
                    </div>
                </div>

                <!-- Recent Alerts -->
                <div class="alert alert-warning mb-4" id="alertsContainer">
                    <strong><i class="fas fa-bell me-2"></i>System Alerts</strong>
                    <hr class="my-2">
                    <ul class="mb-0" id="alertsList">
                        <li>0 students have balance below ₦500</li>
                        <li>Last backup completed: 2 hours ago</li>
                        <li>0 new parent registrations pending approval</li>
                    </ul>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions">
                    <a href="#" class="quick-action-btn" onclick="showSection('parents')">
                        <i class="fas fa-user-plus"></i>
                        <div>Add New Parent</div>
                    </a>
                    <a href="#" class="quick-action-btn" onclick="showSection('students')">
                        <i class="fas fa-graduation-cap"></i>
                        <div>Manage Students</div>
                    </a>
                    <a href="#" class="quick-action-btn" onclick="openTopupModal()">
                        <i class="fas fa-plus-circle"></i>
                        <div>Top-up Balance</div>
                    </a>
                    <a href="#" class="quick-action-btn" onclick="showSection('reports')">
                        <i class="fas fa-download"></i>
                        <div>Generate Report</div>
                    </a>
                </div>
            </div>

            <!-- Parent Management Section -->
            <div class="section" id="parents">
                <div class="section-header">
                    <h2 class="section-title">Parent Management</h2>
                    <button class="btn btn-primary" onclick="openParentModal()">
                        <i class="fas fa-plus me-2"></i>Add New Parent
                    </button>
                </div>

                <div class="data-table">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Parent ID</th>
                                <th>Name</th>
                                <th>Children</th>
                                <th>Total Balance</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="parentsTable">
                            <!-- Parent data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Student Management Section -->
            <div class="section" id="students">
                <div class="section-header">
                    <h2 class="section-title">Student Management</h2>
                    <button class="btn btn-primary" onclick="openStudentModal()">
                        <i class="fas fa-plus me-2"></i>Add New Student
                    </button>
                </div>

                <div class="data-table">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Student ID</th>
                                <th>Name</th>
                                <th>Class</th>
                                <th>Balance</th>
                                <th>Parent</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="studentsTable">
                            <!-- Student data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Transactions Section -->
            <div class="section" id="transactions">
                <div class="section-header">
                    <h2 class="section-title">Transaction History</h2>
                    <div>
                        <select class="form-select" id="transactionFilter" onchange="filterTransactions()">
                            <option value="all">All Transactions</option>
                            <option value="topup">Top-ups</option>
                            <option value="purchase">Purchases</option>
                            <option value="today">Today</option>
                            <option value="week">This Week</option>
                        </select>
                    </div>
                </div>

                <div class="data-table">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Transaction ID</th>
                                <th>Student</th>
                                <th>Type</th>
                                <th>Amount</th>
                                <th>Date</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="transactionsTable">
                            <!-- Transaction data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Reports Section -->
            <div class="section" id="reports">
                <div class="section-header">
                    <h2 class="section-title">Reports & Analytics</h2>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-4">
                        <div class="stat-card">
                            <h5>Daily Transactions</h5>
                            <canvas id="dailyChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="stat-card">
                            <h5>Balance Distribution</h5>
                            <canvas id="balanceChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                </div>

                <div class="quick-actions">
                    <a href="#" class="quick-action-btn" onclick="generateReport('daily')">
                        <i class="fas fa-calendar-day"></i>
                        <div>Daily Report</div>
                    </a>
                    <a href="#" class="quick-action-btn" onclick="generateReport('weekly')">
                        <i class="fas fa-calendar-week"></i>
                        <div>Weekly Report</div>
                    </a>
                    <a href="#" class="quick-action-btn" onclick="generateReport('monthly')">
                        <i class="fas fa-calendar-alt"></i>
                        <div>Monthly Report</div>
                    </a>
                    <a href="#" class="quick-action-btn" onclick="exportData()">
                        <i class="fas fa-file-export"></i>
                        <div>Export Data</div>
                    </a>
                </div>
            </div>

            <!-- Settings Section -->
            <div class="section" id="settings">
                <div class="section-header">
                    <h2 class="section-title">System Settings</h2>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="stat-card">
                            <h5><i class="fas fa-key me-2"></i>Change Admin Password</h5>
                            <form onsubmit="changePassword(event)">
                                <div class="mb-3">
                                    <label class="form-label">Current Password</label>
                                    <input type="password" class="form-control" id="currentPassword" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">New Password</label>
                                    <input type="password" class="form-control" id="newPassword" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Confirm New Password</label>
                                    <input type="password" class="form-control" id="confirmPassword" required>
                                </div>
                                <button type="submit" class="btn btn-primary">Update Password</button>
                            </form>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="stat-card">
                            <h5><i class="fas fa-cogs me-2"></i>System Information</h5>
                            <div class="mb-3">
                                <strong>Version:</strong> TuckshopKonnect v2.0.1
                            </div>
                            <div class="mb-3">
                                <strong>Last Backup:</strong> <span id="lastBackup">2 hours ago</span>
                            </div>
                            <div class="mb-3">
                                <strong>Uptime:</strong> <span id="systemUptime">5 days, 12 hours</span>
                            </div>
                            <div class="mb-3">
                                <strong>Active Sessions:</strong> <span id="activeSessions">23</span>
                            </div>
                            <button class="btn btn-warning me-2" onclick="createBackup()">
                                <i class="fas fa-download me-1"></i>Create Backup
                            </button>
                            <button class="btn btn-info" onclick="clearCache()">
                                <i class="fas fa-broom me-1"></i>Clear Cache
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    
    <!-- Add/Edit Parent Modal -->
    <div class="modal fade" id="parentModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="parentModalTitle">Add New Parent</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form onsubmit="saveParent(event)">
                    <div class="modal-body">
                        <input type="hidden" id="editParentId">
                        
                        <div class="mb-3">
                            <label class="form-label">Parent ID</label>
                            <input type="text" class="form-control" id="parentId" placeholder="PAR031" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="parentName" placeholder="Enter parent's full name" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-control" id="parentPassword" placeholder="Default: pass123" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Email (Optional)</label>
                            <input type="email" class="form-control" id="parentEmail" placeholder="parent@email.com">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Phone (Optional)</label>
                            <input type="tel" class="form-control" id="parentPhone" placeholder="080xxxxxxxx">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Parent</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add/Edit Student Modal -->
    <div class="modal fade" id="studentModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="studentModalTitle">Add New Student</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form onsubmit="saveStudent(event)">
                    <div class="modal-body">
                        <input type="hidden" id="editStudentId">
                        
                        <div class="mb-3">
                            <label class="form-label">Student ID</label>
                            <input type="text" class="form-control" id="studentId" placeholder="STU058" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="studentName" placeholder="Enter student's full name" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Class</label>
                            <select class="form-select" id="studentClass" required>
                                <option value="">Select Class</option>
                                <option value="JSS1A">JSS1A</option>
                                <option value="JSS1B">JSS1B</option>
                                <option value="JSS1C">JSS1C</option>
                                <option value="JSS2A">JSS2A</option>
                                <option value="JSS2B">JSS2B</option>
                                <option value="JSS2C">JSS2C</option>
                                <option value="JSS3A">JSS3A</option>
                                <option value="JSS3B">JSS3B</option>
                                <option value="JSS3C">JSS3C</option>
                                <option value="SS1A">SS1A</option>
                                <option value="SS1B">SS1B</option>
                                <option value="SS1C">SS1C</option>
                                <option value="SS2A">SS2A</option>
                                <option value="SS2B">SS2B</option>
                                <option value="SS2C">SS2C</option>
                                <option value="SS3A">SS3A</option>
                                <option value="SS3B">SS3B</option>
                                <option value="SS3C">SS3C</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Initial Balance (₦)</label>
                            <input type="number" class="form-control" id="studentBalance" placeholder="1000" min="0" step="50" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Parent</label>
                            <select class="form-select" id="studentParent" required>
                                <option value="">Select Parent</option>
                                <!-- Parent options will be populated -->
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Student</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Top-up Modal -->
    <div class="modal fade" id="topupModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Top-up Student Balance</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form onsubmit="processTopup(event)">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Select Student</label>
                            <select class="form-select" id="topupStudent" required onchange="updateCurrentBalance()">
                                <option value="">Choose student to top-up</option>
                                <!-- Student options will be populated -->
                            </select>
                        </div>
                        
                        <div class="mb-3" id="currentBalanceDiv" style="display: none;">
                            <label class="form-label">Current Balance</label>
                            <div class="form-control" style="background: rgba(16, 185, 129, 0.1); border-color: #10b981;">
                                <strong id="currentBalance">₦0</strong>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Top-up Amount</label>
                            
                            <!-- Preset Amounts -->
                            <div class="mb-3">
                                <div class="btn-group w-100" role="group">
                                    <button type="button" class="btn btn-outline-secondary" onclick="setTopupAmount(500)">₦500</button>
                                    <button type="button" class="btn btn-outline-secondary" onclick="setTopupAmount(1000)">₦1000</button>
                                    <button type="button" class="btn btn-outline-secondary" onclick="setTopupAmount(2000)">₦2000</button>
                                    <button type="button" class="btn btn-outline-secondary" onclick="setTopupAmount(5000)">₦5000</button>
                                </div>
                            </div>
                            
                            <!-- Custom Amount -->
                            <input type="number" class="form-control" id="topupAmount" placeholder="Enter custom amount" min="50" step="50" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Payment Method</label>
                            <select class="form-select" id="paymentMethod" required>
                                <option value="cash">Cash Payment</option>
                                <option value="bank_transfer">Bank Transfer</option>
                                <option value="pos">POS Payment</option>
                                <option value="mobile_money">Mobile Money</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Reference/Notes (Optional)</label>
                            <input type="text" class="form-control" id="topupReference" placeholder="Payment reference or notes">
                        </div>
                        
                        <div class="mb-3" id="newBalanceDiv" style="display: none;">
                            <label class="form-label">New Balance</label>
                            <div class="form-control" style="background: rgba(59, 130, 246, 0.1); border-color: #3b82f6;">
                                <strong id="newBalance">₦0</strong>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus-circle me-1"></i>Process Top-up
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        // Check if admin is logged in
        if (!sessionStorage.getItem('adminLoggedIn')) {
            window.location.href = 'index.html';
        }

        // Initialize admin data
        let adminCredentials = JSON.parse(localStorage.getItem('adminCredentials')) || {
            username: 'admin',
            password: '123'
        };

        // Demo data (same as parent login)
        let demoParents = JSON.parse(localStorage.getItem('adminParents')) || [
            { parentId: 'PAR001', password: 'pass123', name: 'Adebayo Olumide', children: ['Kemi Adebayo'], email: 'adebayo@email.com', phone: '08012345671' },
            { parentId: 'PAR002', password: 'pass123', name: 'Chioma Okafor', children: ['Emeka Okafor'], email: 'chioma@email.com', phone: '08012345672' },
            { parentId: 'PAR003', password: 'pass123', name: 'Ibrahim Musa', children: ['Fatima Ibrahim'], email: 'ibrahim@email.com', phone: '08012345673' },
            { parentId: 'PAR004', password: 'pass123', name: 'Grace Okoro', children: ['David Okoro'], email: 'grace@email.com', phone: '08012345674' },
            { parentId: 'PAR005', password: 'pass123', name: 'Segun Adeyemi', children: ['Tolu Adeyemi'], email: 'segun@email.com', phone: '08012345675' },
            { parentId: 'PAR006', password: 'pass123', name: 'Blessing Ezeh', children: ['Chinedu Ezeh'], email: 'blessing@email.com', phone: '08012345676' },
            { parentId: 'PAR007', password: 'pass123', name: 'Yakubu Aliyu', children: ['Amina Yakubu'], email: 'yakubu@email.com', phone: '08012345677' },
            { parentId: 'PAR008', password: 'pass123', name: 'Funmi Ajayi', children: ['Folake Ajayi'], email: 'funmi@email.com', phone: '08012345678' },
            { parentId: 'PAR009', password: 'pass123', name: 'Chidi Nnadi', children: ['Kelechi Nnadi'], email: 'chidi@email.com', phone: '08012345679' },
            { parentId: 'PAR010', password: 'pass123', name: 'Amaka Obi', children: ['Nkem Obi'], email: 'amaka@email.com', phone: '08012345680' },
            { parentId: 'PAR011', password: 'pass123', name: 'Taiwo Balogun', children: ['Kehinde Balogun', 'Taiye Balogun'], email: 'taiwo@email.com', phone: '08012345681' },
            { parentId: 'PAR012', password: 'pass123', name: 'Ngozi Okonkwo', children: ['Chuka Okonkwo', 'Ada Okonkwo'], email: 'ngozi@email.com', phone: '08012345682' },
            { parentId: 'PAR013', password: 'pass123', name: 'Musa Garba', children: ['Hadiza Musa', 'Yusuf Musa'], email: 'musa@email.com', phone: '08012345683' },
            { parentId: 'PAR014', password: 'pass123', name: 'Kemi Adewale', children: ['Tope Adewale', 'Bisi Adewale'], email: 'kemi@email.com', phone: '08012345684' },
            { parentId: 'PAR015', password: 'pass123', name: 'Emeka Nwosu', children: ['Chioma Nwosu', 'Ikenna Nwosu'], email: 'emeka@email.com', phone: '08012345685' },
            { parentId: 'PAR016', password: 'pass123', name: 'Hauwa Abdullahi', children: ['Aisha Hauwa', 'Umar Hauwa'], email: 'hauwa@email.com', phone: '08012345686' },
            { parentId: 'PAR017', password: 'pass123', name: 'Tunde Ogundipe', children: ['Yemi Ogundipe', 'Sola Ogundipe'], email: 'tunde@email.com', phone: '08012345687' },
            { parentId: 'PAR018', password: 'pass123', name: 'Joy Okechukwu', children: ['Prince Okechukwu', 'Princess Okechukwu'], email: 'joy@email.com', phone: '08012345688' },
            { parentId: 'PAR019', password: 'pass123', name: 'Aliyu Tanko', children: ['Maryam Aliyu', 'Ahmed Aliyu'], email: 'aliyu@email.com', phone: '08012345689' },
            { parentId: 'PAR020', password: 'pass123', name: 'Ife Akinyemi', children: ['Damilola Akinyemi', 'Temilola Akinyemi'], email: 'ife@email.com', phone: '08012345690' },
            { parentId: 'PAR021', password: 'pass123', name: 'Chinonso Okwu', children: ['Chidera Okwu', 'Chidimma Okwu'], email: 'chinonso@email.com', phone: '08012345691' },
            { parentId: 'PAR022', password: 'pass123', name: 'Abubakar Sani', children: ['Zainab Abubakar', 'Ibrahim Abubakar'], email: 'abubakar@email.com', phone: '08012345692' },
            { parentId: 'PAR023', password: 'pass123', name: 'Shade Adebayo', children: ['Tosin Adebayo', 'Doyin Adebayo'], email: 'shade@email.com', phone: '08012345693' },
            { parentId: 'PAR024', password: 'pass123', name: 'Nkem Eze', children: ['Uchenna Eze', 'Adanna Eze'], email: 'nkem@email.com', phone: '08012345694' },
            { parentId: 'PAR025', password: 'pass123', name: 'Rashid Bello', children: ['Safiya Rashid', 'Mubarak Rashid'], email: 'rashid@email.com', phone: '08012345695' },
            { parentId: 'PAR026', password: 'pass123', name: 'Biodun Adeoye', children: ['Tobi Adeoye', 'Femi Adeoye', 'Kemi Adeoye'], email: 'biodun@email.com', phone: '08012345696' },
            { parentId: 'PAR027', password: 'pass123', name: 'Comfort Udoh', children: ['Emmanuel Udoh', 'Grace Udoh', 'Faith Udoh'], email: 'comfort@email.com', phone: '08012345697' },
            { parentId: 'PAR028', password: 'pass123', name: 'Salisu Ahmad', children: ['Fatima Salisu', 'Usman Salisu', 'Halima Salisu', 'Aliyu Salisu'], email: 'salisu@email.com', phone: '08012345698' },
            { parentId: 'PAR029', password: 'pass123', name: 'Adunni Bakare', children: ['Bukola Bakare', 'Ronke Bakare', 'Wale Bakare'], email: 'adunni@email.com', phone: '08012345699' },
            { parentId: 'PAR030', password: 'pass123', name: 'Ifeanyi Okafor', children: ['Chineye Okafor', 'Chukwuma Okafor', 'Chiamaka Okafor', 'Chidubem Okafor'], email: 'ifeanyi@email.com', phone: '08012345700' }
        ];

        let studentData = JSON.parse(localStorage.getItem('adminStudents')) || {
            'Kemi Adebayo': { id: 'STU001', class: 'JSS2A', balance: 1500, parent: 'PAR001' },
            'Emeka Okafor': { id: 'STU002', class: 'SS1B', balance: 2300, parent: 'PAR002' },
            'Fatima Ibrahim': { id: 'STU003', class: 'JSS1C', balance: 800, parent: 'PAR003' },
            'David Okoro': { id: 'STU004', class: 'SS2A', balance: 3200, parent: 'PAR004' },
            'Tolu Adeyemi': { id: 'STU005', class: 'JSS3B', balance: 1900, parent: 'PAR005' },
            'Chinedu Ezeh': { id: 'STU006', class: 'SS1A', balance: 2700, parent: 'PAR006' },
            'Amina Yakubu': { id: 'STU007', class: 'JSS2C', balance: 1200, parent: 'PAR007' },
            'Folake Ajayi': { id: 'STU008', class: 'SS3A', balance: 4100, parent: 'PAR008' },
            'Kelechi Nnadi': { id: 'STU009', class: 'JSS1A', balance: 950, parent: 'PAR009' },
            'Nkem Obi': { id: 'STU010', class: 'SS2B', balance: 2850, parent: 'PAR010' },
            'Kehinde Balogun': { id: 'STU011', class: 'JSS3A', balance: 1750, parent: 'PAR011' },
            'Taiye Balogun': { id: 'STU012', class: 'JSS1B', balance: 1200, parent: 'PAR011' },
            'Chuka Okonkwo': { id: 'STU013', class: 'SS2A', balance: 3100, parent: 'PAR012' },
            'Ada Okonkwo': { id: 'STU014', class: 'JSS2B', balance: 1650, parent: 'PAR012' },
            'Hadiza Musa': { id: 'STU015', class: 'SS1C', balance: 2400, parent: 'PAR013' },
            'Yusuf Musa': { id: 'STU016', class: 'JSS3C', balance: 1800, parent: 'PAR013' },
            'Tope Adewale': { id: 'STU017', class: 'SS3B', balance: 3800, parent: 'PAR014' },
            'Bisi Adewale': { id: 'STU018', class: 'JSS1A', balance: 900, parent: 'PAR014' },
            'Chioma Nwosu': { id: 'STU019', class: 'SS2C', balance: 2950, parent: 'PAR015' },
            'Ikenna Nwosu': { id: 'STU020', class: 'JSS2A', balance: 1550, parent: 'PAR015' },
            'Aisha Hauwa': { id: 'STU021', class: 'SS1A', balance: 2200, parent: 'PAR016' },
            'Umar Hauwa': { id: 'STU022', class: 'JSS3A', balance: 1700, parent: 'PAR016' },
            'Yemi Ogundipe': { id: 'STU023', class: 'SS3A', balance: 4200, parent: 'PAR017' },
            'Sola Ogundipe': { id: 'STU024', class: 'JSS1C', balance: 850, parent: 'PAR017' },
            'Prince Okechukwu': { id: 'STU025', class: 'SS2A', balance: 3050, parent: 'PAR018' },
            'Princess Okechukwu': { id: 'STU026', class: 'JSS2B', balance: 1450, parent: 'PAR018' },
            'Maryam Aliyu': { id: 'STU027', class: 'SS1B', balance: 2600, parent: 'PAR019' },
            'Ahmed Aliyu': { id: 'STU028', class: 'JSS3B', balance: 1900, parent: 'PAR019' },
            'Damilola Akinyemi': { id: 'STU029', class: 'SS3C', balance: 3900, parent: 'PAR020' },
            'Temilola Akinyemi': { id: 'STU030', class: 'JSS1A', balance: 750, parent: 'PAR020' },
            'Chidera Okwu': { id: 'STU031', class: 'SS2B', balance: 2750, parent: 'PAR021' },
            'Chidimma Okwu': { id: 'STU032', class: 'JSS2C', balance: 1350, parent: 'PAR021' },
            'Zainab Abubakar': { id: 'STU033', class: 'SS1C', balance: 2350, parent: 'PAR022' },
            'Ibrahim Abubakar': { id: 'STU034', class: 'JSS3A', balance: 1650, parent: 'PAR022' },
            'Tosin Adebayo': { id: 'STU035', class: 'SS3A', balance: 4000, parent: 'PAR023' },
            'Doyin Adebayo': { id: 'STU036', class: 'JSS1B', balance: 950, parent: 'PAR023' },
            'Uchenna Eze': { id: 'STU037', class: 'SS2A', balance: 2900, parent: 'PAR024' },
            'Adanna Eze': { id: 'STU038', class: 'JSS2A', balance: 1500, parent: 'PAR024' },
            'Safiya Rashid': { id: 'STU039', class: 'SS1A', balance: 2150, parent: 'PAR025' },
            'Mubarak Rashid': { id: 'STU040', class: 'JSS3C', balance: 1750, parent: 'PAR025' },
            'Tobi Adeoye': { id: 'STU041', class: 'SS3B', balance: 3700, parent: 'PAR026' },
            'Femi Adeoye': { id: 'STU042', class: 'SS1B', balance: 2100, parent: 'PAR026' },
            'Kemi Adeoye': { id: 'STU043', class: 'JSS2A', balance: 1300, parent: 'PAR026' },
            'Emmanuel Udoh': { id: 'STU044', class: 'SS2C', balance: 2800, parent: 'PAR027' },
            'Grace Udoh': { id: 'STU045', class: 'JSS3B', balance: 1600, parent: 'PAR027' },
            'Faith Udoh': { id: 'STU046', class: 'JSS1C', balance: 800, parent: 'PAR027' },
            'Fatima Salisu': { id: 'STU047', class: 'SS3A', balance: 3600, parent: 'PAR028' },
            'Usman Salisu': { id: 'STU048', class: 'SS1A', balance: 2250, parent: 'PAR028' },
            'Halima Salisu': { id: 'STU049', class: 'JSS2B', balance: 1400, parent: 'PAR028' },
            'Aliyu Salisu': { id: 'STU050', class: 'JSS1A', balance: 700, parent: 'PAR028' },
            'Bukola Bakare': { id: 'STU051', class: 'SS2A', balance: 3200, parent: 'PAR029' },
            'Ronke Bakare': { id: 'STU052', class: 'JSS3C', balance: 1850, parent: 'PAR029' },
            'Wale Bakare': { id: 'STU053', class: 'JSS1B', balance: 950, parent: 'PAR029' },
            'Chineye Okafor': { id: 'STU054', class: 'SS3C', balance: 4300, parent: 'PAR030' },
            'Chukwuma Okafor': { id: 'STU055', class: 'SS1C', balance: 2500, parent: 'PAR030' },
            'Chiamaka Okafor': { id: 'STU056', class: 'JSS2C', balance: 1250, parent: 'PAR030' },
            'Chidubem Okafor': { id: 'STU057', class: 'JSS1A', balance: 600, parent: 'PAR030' }
        };

        // Transaction history
        let transactions = JSON.parse(localStorage.getItem('adminTransactions')) || [];

        // Session management
        let sessionTimeout;
        const SESSION_DURATION = 45 * 60 * 1000; // 45 minutes

        function startSession() {
            clearTimeout(sessionTimeout);
            sessionTimeout = setTimeout(() => {
                alert('Administrator session has expired. Please login again.');
                logout();
            }, SESSION_DURATION);
        }

        function resetSessionTimer() {
            startSession();
        }

        function logout() {
            sessionStorage.clear();
            window.location.href = 'index.html';
        }

        // Navigation functions
        function showSection(sectionName) {
            // Update navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`[data-section="${sectionName}"]`).classList.add('active');

            // Update sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionName).classList.add('active');

            // Update page title
            const titles = {
                dashboard: 'Dashboard Overview',
                parents: 'Parent Management',
                students: 'Student Management', 
                transactions: 'Transaction History',
                reports: 'Reports & Analytics',
                settings: 'System Settings'
            };
            document.getElementById('pageTitle').textContent = titles[sectionName];

            // Load section data
            switch(sectionName) {
                case 'parents':
                    loadParentsData();
                    break;
                case 'students':
                    loadStudentsData();
                    break;
                case 'transactions':
                    loadTransactionsData();
                    break;
                case 'reports':
                    initializeCharts();
                    break;
            }
        }

        // Load data functions
        function loadParentsData() {
            const tbody = document.getElementById('parentsTable');
            tbody.innerHTML = '';

            demoParents.forEach(parent => {
                const totalBalance = parent.children.reduce((sum, child) => {
                    return sum + (studentData[child]?.balance || 0);
                }, 0);

                const status = totalBalance > 1000 ? 'Active' : totalBalance > 0 ? 'Low Balance' : 'Inactive';
                const statusClass = totalBalance > 1000 ? 'bg-success' : totalBalance > 0 ? 'bg-warning' : 'bg-danger';

                tbody.innerHTML += `
                    <tr>
                        <td>${parent.parentId}</td>
                        <td>${parent.name}</td>
                        <td>${parent.children.length}</td>
                        <td>₦${totalBalance.toLocaleString()}</td>
                        <td><span class="badge ${statusClass}">${status}</span></td>
                        <td>
                            <button class="btn btn-info btn-sm" onclick="editParent('${parent.parentId}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-warning btn-sm" onclick="resetParentPassword('${parent.parentId}')">
                                <i class="fas fa-key"></i>
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteParent('${parent.parentId}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
        }

        function loadStudentsData() {
            const tbody = document.getElementById('studentsTable');
            tbody.innerHTML = '';

            Object.entries(studentData).forEach(([name, student]) => {
                const parent = demoParents.find(p => p.parentId === student.parent);
                const status = student.balance > 500 ? 'Active' : student.balance > 0 ? 'Low Balance' : 'Inactive';
                const statusClass = student.balance > 500 ? 'bg-success' : student.balance > 0 ? 'bg-warning' : 'bg-danger';

                tbody.innerHTML += `
                    <tr>
                        <td>${student.id}</td>
                        <td>${name}</td>
                        <td>${student.class}</td>
                        <td>₦${student.balance.toLocaleString()}</td>
                        <td>${parent ? parent.name : 'Unassigned'}</td>
                        <td><span class="badge ${statusClass}">${status}</span></td>
                        <td>
                            <button class="btn btn-info btn-sm" onclick="editStudent('${name}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-warning btn-sm" onclick="topupStudent('${name}')">
                                <i class="fas fa-plus-circle"></i>
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteStudent('${name}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });

            // Populate parent options for new students
            const parentSelect = document.getElementById('studentParent');
            parentSelect.innerHTML = '<option value="">Select Parent</option>';
            demoParents.forEach(parent => {
                parentSelect.innerHTML += `<option value="${parent.parentId}">${parent.name} (${parent.parentId})</option>`;
            });

            // Populate student options for topup
            const topupSelect = document.getElementById('topupStudent');
            topupSelect.innerHTML = '<option value="">Choose student to top-up</option>';
            Object.entries(studentData).forEach(([name, student]) => {
                topupSelect.innerHTML += `<option value="${name}">${name} (${student.id}) - ₦${student.balance}</option>`;
            });
        }

        function loadTransactionsData() {
            const tbody = document.getElementById('transactionsTable');
            tbody.innerHTML = '';

            // Generate some sample transactions if none exist
            if (transactions.length === 0) {
                generateSampleTransactions();
            }

            transactions.forEach(transaction => {
                const statusClass = transaction.status === 'completed' ? 'bg-success' : 
                                   transaction.status === 'pending' ? 'bg-warning' : 'bg-danger';

                tbody.innerHTML += `
                    <tr>
                        <td>${transaction.id}</td>
                        <td>${transaction.student}</td>
                        <td>${transaction.type}</td>
                        <td>₦${transaction.amount.toLocaleString()}</td>
                        <td>${new Date(transaction.date).toLocaleDateString()}</td>
                        <td><span class="badge ${statusClass}">${transaction.status}</span></td>
                    </tr>
                `;
            });
        }

        function generateSampleTransactions() {
            const types = ['topup', 'purchase'];
            const statuses = ['completed', 'pending'];
            const students = Object.keys(studentData);
            
            for (let i = 1; i <= 50; i++) {
                const randomStudent = students[Math.floor(Math.random() * students.length)];
                const type = types[Math.floor(Math.random() * types.length)];
                const amount = type === 'topup' ? 
                    [500, 1000, 1500, 2000, 2500, 3000][Math.floor(Math.random() * 6)] :
                    Math.floor(Math.random() * 500) + 50;
                
                const date = new Date();
                date.setDate(date.getDate() - Math.floor(Math.random() * 30));

                transactions.push({
                    id: `TXN${String(i).padStart(3, '0')}`,
                    student: randomStudent,
                    type: type,
                    amount: amount,
                    date: date.toISOString(),
                    status: statuses[Math.floor(Math.random() * statuses.length)]
                });
            }

            localStorage.setItem('adminTransactions', JSON.stringify(transactions));
        }

        // Modal functions
        function openParentModal(parentId = null) {
            const modal = new bootstrap.Modal(document.getElementById('parentModal'));
            const title = document.getElementById('parentModalTitle');
            
            if (parentId) {
                const parent = demoParents.find(p => p.parentId === parentId);
                if (parent) {
                    title.textContent = 'Edit Parent';
                    document.getElementById('editParentId').value = parentId;
                    document.getElementById('parentId').value = parent.parentId;
                    document.getElementById('parentName').value = parent.name;
                    document.getElementById('parentPassword').value = parent.password;
                    document.getElementById('parentEmail').value = parent.email || '';
                    document.getElementById('parentPhone').value = parent.phone || '';
                    document.getElementById('parentId').readOnly = true;
                }
            } else {
                title.textContent = 'Add New Parent';
                document.getElementById('parentModal').querySelector('form').reset();
                document.getElementById('editParentId').value = '';
                document.getElementById('parentId').readOnly = false;
                
                // Auto-generate next parent ID
                const maxId = Math.max(...demoParents.map(p => parseInt(p.parentId.replace('PAR', ''))));
                document.getElementById('parentId').value = `PAR${String(maxId + 1).padStart(3, '0')}`;
                document.getElementById('parentPassword').value = 'pass123';
            }
            
            modal.show();
        }

        function openStudentModal(studentName = null) {
            const modal = new bootstrap.Modal(document.getElementById('studentModal'));
            const title = document.getElementById('studentModalTitle');
            
            if (studentName) {
                const student = studentData[studentName];
                if (student) {
                    title.textContent = 'Edit Student';
                    document.getElementById('editStudentId').value = studentName;
                    document.getElementById('studentId').value = student.id;
                    document.getElementById('studentName').value = studentName;
                    document.getElementById('studentClass').value = student.class;
                    document.getElementById('studentBalance').value = student.balance;
                    document.getElementById('studentParent').value = student.parent;
                    document.getElementById('studentId').readOnly = true;
                }
            } else {
                title.textContent = 'Add New Student';
                document.getElementById('studentModal').querySelector('form').reset();
                document.getElementById('editStudentId').value = '';
                document.getElementById('studentId').readOnly = false;
                
                // Auto-generate next student ID
                const maxId = Math.max(...Object.values(studentData).map(s => parseInt(s.id.replace('STU', ''))));
                document.getElementById('studentId').value = `STU${String(maxId + 1).padStart(3, '0')}`;
                document.getElementById('studentBalance').value = 1000;
            }
            
            modal.show();
        }

        function openTopupModal(studentName = null) {
            const modal = new bootstrap.Modal(document.getElementById('topupModal'));
            
            if (studentName) {
                document.getElementById('topupStudent').value = studentName;
                updateCurrentBalance();
            } else {
                document.getElementById('topupModal').querySelector('form').reset();
                document.getElementById('currentBalanceDiv').style.display = 'none';
                document.getElementById('newBalanceDiv').style.display = 'none';
            }
            
            modal.show();
        }

        // CRUD operations
        function saveParent(event) {
            event.preventDefault();
            
            const parentId = document.getElementById('parentId').value.trim().toUpperCase();
            const name = document.getElementById('parentName').value.trim();
            const password = document.getElementById('parentPassword').value.trim();
            const email = document.getElementById('parentEmail').value.trim();
            const phone = document.getElementById('parentPhone').value.trim();
            const editId = document.getElementById('editParentId').value;
            
            if (editId) {
                // Edit existing parent
                const index = demoParents.findIndex(p => p.parentId === editId);
                if (index !== -1) {
                    demoParents[index] = { ...demoParents[index], parentId, name, password, email, phone };
                    
                    // Update student data if parent ID changed
                    if (editId !== parentId) {
                        Object.entries(studentData).forEach(([studentName, student]) => {
                            if (student.parent === editId) {
                                student.parent = parentId;
                            }
                        });
                    }
                    
                    showAlert('Parent updated successfully!', 'success');
                }
            } else {
                // Add new parent
                if (demoParents.find(p => p.parentId === parentId)) {
                    showAlert('Parent ID already exists!', 'danger');
                    return;
                }
                
                demoParents.push({
                    parentId, name, password, email, phone,
                    children: []
                });
                
                showAlert('New parent added successfully!', 'success');
            }
            
            // Save to localStorage
            localStorage.setItem('adminParents', JSON.stringify(demoParents));
            
            // Close modal and refresh data
            bootstrap.Modal.getInstance(document.getElementById('parentModal')).hide();
            loadParentsData();
            updateDashboardStats();
        }

        function saveStudent(event) {
            event.preventDefault();
            
            const studentId = document.getElementById('studentId').value.trim().toUpperCase();
            const name = document.getElementById('studentName').value.trim();
            const studentClass = document.getElementById('studentClass').value;
            const balance = parseInt(document.getElementById('studentBalance').value) || 0;
            const parentId = document.getElementById('studentParent').value;
            const editName = document.getElementById('editStudentId').value;
            
            if (editName && editName !== name) {
                // Edit existing student (name changed)
                if (studentData[name]) {
                    showAlert('Student name already exists!', 'danger');
                    return;
                }
                
                // Update student data
                studentData[name] = { ...studentData[editName], id: studentId, class: studentClass, balance, parent: parentId };
                delete studentData[editName];
                
                // Update parent's children list
                demoParents.forEach(parent => {
                    const childIndex = parent.children.indexOf(editName);
                    if (childIndex !== -1) {
                        parent.children[childIndex] = name;
                    }
                });
                
                showAlert('Student updated successfully!', 'success');
            } else if (editName) {
                // Edit existing student (name unchanged)
                studentData[editName] = { id: studentId, class: studentClass, balance, parent: parentId };
                showAlert('Student updated successfully!', 'success');
            } else {
                // Add new student
                if (studentData[name]) {
                    showAlert('Student name already exists!', 'danger');
                    return;
                }
                
                if (Object.values(studentData).find(s => s.id === studentId)) {
                    showAlert('Student ID already exists!', 'danger');
                    return;
                }
                
                studentData[name] = { id: studentId, class: studentClass, balance, parent: parentId };
                
                // Add to parent's children list
                const parent = demoParents.find(p => p.parentId === parentId);
                if (parent) {
                    parent.children.push(name);
                }
                
                showAlert('New student added successfully!', 'success');
            }
            
            // Save to localStorage
            localStorage.setItem('adminStudents', JSON.stringify(studentData));
            localStorage.setItem('adminParents', JSON.stringify(demoParents));
            
            // Close modal and refresh data
            bootstrap.Modal.getInstance(document.getElementById('studentModal')).hide();
            loadStudentsData();
            updateDashboardStats();
        }

        function processTopup(event) {
            event.preventDefault();
            
            const studentName = document.getElementById('topupStudent').value;
            const amount = parseInt(document.getElementById('topupAmount').value) || 0;
            const paymentMethod = document.getElementById('paymentMethod').value;
            const reference = document.getElementById('topupReference').value.trim();
            
            if (!studentName || amount <= 0) {
                showAlert('Please select student and enter valid amount!', 'danger');
                return;
            }
            
            // Update student balance
            studentData[studentName].balance += amount;
            
            // Add transaction record
            const transaction = {
                id: `TXN${String(transactions.length + 1).padStart(3, '0')}`,
                student: studentName,
                type: 'topup',
                amount: amount,
                date: new Date().toISOString(),
                status: 'completed',
                method: paymentMethod,
                reference: reference || 'Admin Top-up'
            };
            
            transactions.unshift(transaction);
            
            // Save to localStorage
            localStorage.setItem('adminStudents', JSON.stringify(studentData));
            localStorage.setItem('adminTransactions', JSON.stringify(transactions));
            
            // Close modal and refresh data
            bootstrap.Modal.getInstance(document.getElementById('topupModal')).hide();
            showAlert(`Successfully added ₦${amount.toLocaleString()} to ${studentName}'s account!`, 'success');
            
            if (document.getElementById('students').classList.contains('active')) {
                loadStudentsData();
            }
            updateDashboardStats();
        }

        // Edit functions
        function editParent(parentId) {
            openParentModal(parentId);
        }

        function editStudent(studentName) {
            openStudentModal(studentName);
        }

        function topupStudent(studentName) {
            openTopupModal(studentName);
        }

        // Delete functions
        function deleteParent(parentId) {
            if (confirm('Are you sure you want to delete this parent? This will also remove all associated students.')) {
                const parent = demoParents.find(p => p.parentId === parentId);
                if (parent) {
                    // Remove all children
                    parent.children.forEach(childName => {
                        delete studentData[childName];
                    });
                    
                    // Remove parent
                    const index = demoParents.findIndex(p => p.parentId === parentId);
                    demoParents.splice(index, 1);
                    
                    // Save and refresh
                    localStorage.setItem('adminParents', JSON.stringify(demoParents));
                    localStorage.setItem('adminStudents', JSON.stringify(studentData));
                    
                    loadParentsData();
                    updateDashboardStats();
                    showAlert('Parent and associated students deleted successfully!', 'success');
                }
            }
        }

        function deleteStudent(studentName) {
            if (confirm('Are you sure you want to delete this student?')) {
                const student = studentData[studentName];
                if (student) {
                    // Remove from parent's children list
                    const parent = demoParents.find(p => p.parentId === student.parent);
                    if (parent) {
                        const index = parent.children.indexOf(studentName);
                        if (index !== -1) {
                            parent.children.splice(index, 1);
                        }
                    }
                    
                    // Delete student
                    delete studentData[studentName];
                    
                    // Save and refresh
                    localStorage.setItem('adminParents', JSON.stringify(demoParents));
                    localStorage.setItem('adminStudents', JSON.stringify(studentData));
                    
                    loadStudentsData();
                    updateDashboardStats();
                    showAlert('Student deleted successfully!', 'success');
                }
            }
        }

        function resetParentPassword(parentId) {
            const newPassword = prompt('Enter new password for parent:', 'pass123');
            if (newPassword && newPassword.trim()) {
                const parent = demoParents.find(p => p.parentId === parentId);
                if (parent) {
                    parent.password = newPassword.trim();
                    localStorage.setItem('adminParents', JSON.stringify(demoParents));
                    showAlert('Password reset successfully!', 'success');
                }
            }
        }

        // Utility functions
        function updateCurrentBalance() {
            const studentName = document.getElementById('topupStudent').value;
            const currentBalanceDiv = document.getElementById('currentBalanceDiv');
            const newBalanceDiv = document.getElementById('newBalanceDiv');
            
            if (studentName && studentData[studentName]) {
                const currentBalance = studentData[studentName].balance;
                document.getElementById('currentBalance').textContent = `₦${currentBalance.toLocaleString()}`;
                currentBalanceDiv.style.display = 'block';
                
                // Update new balance when amount changes
                const amountInput = document.getElementById('topupAmount');
                amountInput.addEventListener('input', function() {
                    const amount = parseInt(this.value) || 0;
                    if (amount > 0) {
                        document.getElementById('newBalance').textContent = `₦${(currentBalance + amount).toLocaleString()}`;
                        newBalanceDiv.style.display = 'block';
                    } else {
                        newBalanceDiv.style.display = 'none';
                    }
                });
            } else {
                currentBalanceDiv.style.display = 'none';
                newBalanceDiv.style.display = 'none';
            }
        }

        function setTopupAmount(amount) {
            document.getElementById('topupAmount').value = amount;
            updateCurrentBalance();
            
            // Trigger input event to update new balance
            document.getElementById('topupAmount').dispatchEvent(new Event('input'));
        }

        function updateDashboardStats() {
            const totalParents = demoParents.length;
            const totalStudents = Object.keys(studentData).length;
            const totalBalance = Object.values(studentData).reduce((sum, student) => sum + student.balance, 0);
            const lowBalanceCount = Object.values(studentData).filter(student => student.balance < 500).length;
            
            document.getElementById('totalParents').textContent = totalParents;
            document.getElementById('totalStudents').textContent = totalStudents;
            document.getElementById('totalBalance').textContent = `₦${totalBalance.toLocaleString()}`;
            document.getElementById('lowBalanceCount').textContent = lowBalanceCount;
            
            // Update alerts
            const alertsList = document.getElementById('alertsList');
            alertsList.innerHTML = `
                <li>${lowBalanceCount} students have balance below ₦500</li>
                <li>Last backup completed: 2 hours ago</li>
                <li>System running smoothly - ${totalStudents} active accounts</li>
            `;
        }

        function filterTransactions() {
            const filter = document.getElementById('transactionFilter').value;
            let filteredTransactions = [...transactions];
            
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
            
            switch(filter) {
                case 'topup':
                    filteredTransactions = transactions.filter(t => t.type === 'topup');
                    break;
                case 'purchase':
                    filteredTransactions = transactions.filter(t => t.type === 'purchase');
                    break;
                case 'today':
                    filteredTransactions = transactions.filter(t => new Date(t.date) >= today);
                    break;
                case 'week':
                    filteredTransactions = transactions.filter(t => new Date(t.date) >= weekAgo);
                    break;
            }
            
            const tbody = document.getElementById('transactionsTable');
            tbody.innerHTML = '';
            
            filteredTransactions.forEach(transaction => {
                const statusClass = transaction.status === 'completed' ? 'bg-success' : 
                                   transaction.status === 'pending' ? 'bg-warning' : 'bg-danger';

                tbody.innerHTML += `
                    <tr>
                        <td>${transaction.id}</td>
                        <td>${transaction.student}</td>
                        <td>${transaction.type}</td>
                        <td>₦${transaction.amount.toLocaleString()}</td>
                        <td>${new Date(transaction.date).toLocaleDateString()}</td>
                        <td><span class="badge ${statusClass}">${transaction.status}</span></td>
                    </tr>
                `;
            });
        }

        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(alertDiv);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.parentNode.removeChild(alertDiv);
                }
            }, 5000);
        }

        // Charts and reports
        function initializeCharts() {
            // Daily transactions chart
            const dailyCtx = document.getElementById('dailyChart')?.getContext('2d');
            if (dailyCtx) {
                new Chart(dailyCtx, {
                    type: 'line',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                        datasets: [{
                            label: 'Daily Transactions',
                            data: [12, 19, 3, 5, 2, 3, 8],
                            borderColor: '#dc2626',
                            backgroundColor: 'rgba(220, 38, 38, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });
            }

            // Balance distribution chart
            const balanceCtx = document.getElementById('balanceChart')?.getContext('2d');
            if (balanceCtx) {
                const balanceRanges = {
                    'Below ₦500': 0,
                    '₦500 - ₦1500': 0,
                    '₦1500 - ₦3000': 0,
                    'Above ₦3000': 0
                };

                Object.values(studentData).forEach(student => {
                    if (student.balance < 500) balanceRanges['Below ₦500']++;
                    else if (student.balance < 1500) balanceRanges['₦500 - ₦1500']++;
                    else if (student.balance < 3000) balanceRanges['₦1500 - ₦3000']++;
                    else balanceRanges['Above ₦3000']++;
                });

                new Chart(balanceCtx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(balanceRanges),
                        datasets: [{
                            data: Object.values(balanceRanges),
                            backgroundColor: ['#ef4444', '#f59e0b', '#10b981', '#3b82f6']
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
            }
        }

        function generateReport(type) {
            let reportData = '';
            const date = new Date().toLocaleDateString();
            
            switch(type) {
                case 'daily':
                    reportData = generateDailyReport();
                    break;
                case 'weekly':
                    reportData = generateWeeklyReport();
                    break;
                case 'monthly':
                    reportData = generateMonthlyReport();
                    break;
            }
            
            // Create and download report
            const blob = new Blob([reportData], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `TuckshopKonnect_${type}_report_${date.replace(/\//g, '-')}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showAlert(`${type.charAt(0).toUpperCase() + type.slice(1)} report generated successfully!`, 'success');
        }

        function generateDailyReport() {
            const today = new Date().toDateString();
            const todayTransactions = transactions.filter(t => new Date(t.date).toDateString() === today);
            
            let report = `TUCKSHOP KONNECT DAILY REPORT\n`;
            report += `Date: ${today}\n`;
            report += `Generated: ${new Date().toLocaleString()}\n\n`;
            
            report += `SUMMARY:\n`;
            report += `Total Parents: ${demoParents.length}\n`;
            report += `Total Students: ${Object.keys(studentData).length}\n`;
            report += `Total Balance: ₦${Object.values(studentData).reduce((sum, s) => sum + s.balance, 0).toLocaleString()}\n`;
            report += `Today's Transactions: ${todayTransactions.length}\n\n`;
            
            report += `LOW BALANCE ALERTS:\n`;
            Object.entries(studentData).forEach(([name, student]) => {
                if (student.balance < 500) {
                    report += `- ${name} (${student.id}): ₦${student.balance}\n`;
                }
            });
            
            return report;
        }

        function generateWeeklyReport() {
            const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
            const weekTransactions = transactions.filter(t => new Date(t.date) >= weekAgo);
            
            let report = `TUCKSHOP KONNECT WEEKLY REPORT\n`;
            report += `Period: ${weekAgo.toDateString()} - ${new Date().toDateString()}\n`;
            report += `Generated: ${new Date().toLocaleString()}\n\n`;
            
            report += `SUMMARY:\n`;
            report += `Total Parents: ${demoParents.length}\n`;
            report += `Total Students: ${Object.keys(studentData).length}\n`;
            report += `Total Balance: ₦${Object.values(studentData).reduce((sum, s) => sum + s.balance, 0).toLocaleString()}\n`;
            report += `Week's Transactions: ${weekTransactions.length}\n\n`;
            
            report += `TOP STUDENTS BY BALANCE:\n`;
            const sortedStudents = Object.entries(studentData)
                .sort(([,a], [,b]) => b.balance - a.balance)
                .slice(0, 10);
            
            sortedStudents.forEach(([name, student]) => {
                report += `- ${name} (${student.id}): ₦${student.balance.toLocaleString()}\n`;
            });
            
            return report;
        }

        function generateMonthlyReport() {
            const monthAgo = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);
            const monthTransactions = transactions.filter(t => new Date(t.date) >= monthAgo);
            
            let report = `TUCKSHOP KONNECT MONTHLY REPORT\n`;
            report += `Period: ${monthAgo.toDateString()} - ${new Date().toDateString()}\n`;
            report += `Generated: ${new Date().toLocaleString()}\n\n`;
            
            report += `COMPREHENSIVE SUMMARY:\n`;
            report += `Total Parents: ${demoParents.length}\n`;
            report += `Total Students: ${Object.keys(studentData).length}\n`;
            report += `Total System Balance: ₦${Object.values(studentData).reduce((sum, s) => sum + s.balance, 0).toLocaleString()}\n`;
            report += `Month's Transactions: ${monthTransactions.length}\n\n`;
            
            report += `CLASS DISTRIBUTION:\n`;
            const classStats = {};
            Object.values(studentData).forEach(student => {
                classStats[student.class] = (classStats[student.class] || 0) + 1;
            });
            
            Object.entries(classStats).forEach(([className, count]) => {
                report += `- ${className}: ${count} students\n`;
            });
            
            return report;
        }

        function exportData() {
            const data = {
                parents: demoParents,
                students: studentData,
                transactions: transactions,
                exportDate: new Date().toISOString()
            };
            
            const jsonData = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `TuckshopKonnect_data_export_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showAlert('Data exported successfully!', 'success');
        }

        // Settings functions
        function changePassword(event) {
            event.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (currentPassword !== adminCredentials.password) {
                showAlert('Current password is incorrect!', 'danger');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showAlert('New passwords do not match!', 'danger');
                return;
            }
            
            if (newPassword.length < 3) {
                showAlert('New password must be at least 3 characters!', 'danger');
                return;
            }
            
            adminCredentials.password = newPassword;
            localStorage.setItem('adminCredentials', JSON.stringify(adminCredentials));
            
            // Clear form
            event.target.reset();
            
            showAlert('Password changed successfully!', 'success');
        }

        function createBackup() {
            const backupData = {
                parents: demoParents,
                students: studentData,
                transactions: transactions,
                adminCredentials: adminCredentials,
                backupDate: new Date().toISOString()
            };
            
            const jsonData = JSON.stringify(backupData, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `TuckshopKonnect_backup_${new Date().toISOString().replace(/[:.]/g, '-')}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            document.getElementById('lastBackup').textContent = 'Just now';
            showAlert('System backup created successfully!', 'success');
        }

        function clearCache() {
            if (confirm('Are you sure you want to clear the system cache? This may improve performance but will require data to be reloaded.')) {
                // Simulate cache clearing
                setTimeout(() => {
                    showAlert('System cache cleared successfully!', 'success');
                }, 1000);
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication
            if (!sessionStorage.getItem('adminLoggedIn')) {
                window.location.href = 'index.html';
                return;
            }

            // Set admin info
            const adminUsername = sessionStorage.getItem('adminUsername') || 'admin';
            document.getElementById('adminName').textContent = `Administrator (${adminUsername})`;
            document.getElementById('adminInitials').textContent = adminUsername.charAt(0).toUpperCase();
            
            const loginTime = new Date(sessionStorage.getItem('loginTime') || Date.now());
            document.getElementById('lastLogin').textContent = `Last login: ${loginTime.toLocaleString()}`;

            // Initialize session management
            startSession();
            
            // Activity tracking
            ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'].forEach(event => {
                document.addEventListener(event, resetSessionTimer, true);
            });

            // Navigation event listeners
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    showSection(section);
                });
            });

            // Load initial data
            updateDashboardStats();
            loadParentsData();
            loadStudentsData();

            // Mobile sidebar toggle (if needed)
            const sidebar = document.getElementById('sidebar');
            document.addEventListener('click', function(e) {
                if (window.innerWidth <= 768 && !sidebar.contains(e.target)) {
                    sidebar.classList.remove('active');
                }
            });
        });

        // Prevent back button after logout
        window.addEventListener('pageshow', function(event) {
            if (event.persisted && !sessionStorage.getItem('adminLoggedIn')) {
                window.location.href = 'adminlogin.html';
            }
        });
    </script>
</body>

</html>
